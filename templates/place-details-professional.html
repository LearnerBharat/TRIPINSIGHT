{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ single_place.Name }} - TripInsight</title>
    <meta name="description" content="Explore {{ single_place.Name }} in {{ single_place.City }}, {{ single_place.State }}. Find details, reviews, nearby attractions and plan your visit.">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/transitions.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="{% static 'js/navbar.js' %}" defer></script>
    <script src="{% static 'js/transitions.js' %}" defer></script>
    
    <style>
        /* Place Details Page Styles */
        body {
            padding-top: 70px;
        }
        
        /* Hero Section */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
            margin-top: 30px;
        }
        
        @media (max-width: 992px) {
            .hero-section {
                grid-template-columns: 1fr;
            }
        }
        
        .place-info {
            display: flex;
            flex-direction: column;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: var(--text-light);
        }
        
        .breadcrumb a {
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .breadcrumb a:hover {
            color: var(--primary-color);
        }
        
        .breadcrumb i {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .place-info h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .location-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        .location-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .location-meta i {
            color: var(--primary-color);
        }
        
        .description {
            margin-bottom: 30px;
            line-height: 1.7;
            color: var(--text-light);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .estimate-button, .save-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .estimate-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .estimate-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .save-button {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }
        
        .save-button:hover {
            background-color: var(--lightest-color);
            transform: translateY(-2px);
        }
        
        .cost-display {
            background-color: var(--lightest-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .cost-display.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .cost-loader {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: var(--text-light);
        }
        
        .loader {
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-light);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .cost-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .cost-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--card-shadow);
        }
        
        .cost-item h4 {
            margin-bottom: 10px;
            color: var(--secondary-color);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cost-item h4 i {
            color: var(--primary-color);
        }
        
        .cost-item p {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .cost-item span {
            font-size: 14px;
            color: var(--text-light);
            font-weight: normal;
        }
        
        .total-cost {
            grid-column: 1 / -1;
            background-color: var(--lightest-color);
            border: 1px solid var(--primary-light);
        }
        
        .total-cost h4, .total-cost p {
            color: var(--primary-dark);
            font-size: 1.1em;
        }
        
        .cost-note {
            grid-column: 1 / -1;
            margin-top: 15px;
            padding: 10px;
            background-color: var(--lightest-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            color: var(--text-light);
            text-align: center;
        }
        
        .cost-note i {
            color: var(--primary-color);
            margin-right: 5px;
        }
        
        .no-cost-data, .cost-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            grid-column: 1 / -1;
        }
        
        .no-cost-data i, .cost-error i {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--text-muted);
        }
        
        .cost-error i {
            color: #e74c3c;
        }
        
        .no-cost-data p, .cost-error p {
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        .btn-submit-review {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius);
            text-decoration: none;
            font-weight: 500;
            margin-top: 10px;
            transition: var(--transition);
        }
        
        .btn-submit-review:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .place-image {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 450px;
            box-shadow: var(--card-shadow);
        }
        
        .place-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .place-image:hover img {
            transform: scale(1.05);
        }
        
        .image-overlay {
            position: absolute;
            bottom: 20px;
            right: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .place-image:hover .image-overlay {
            opacity: 1;
        }
        
        .gallery-button {
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--primary-color);
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        
        .gallery-button:hover {
            background-color: white;
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        /* Tabs Section */
        .tabs-section {
            margin-bottom: 60px;
        }
        
        .tabs-nav {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 30px;
        }
        
        .tab-button {
            padding: 15px 25px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-button:hover:not(.active) {
            color: var(--text-color);
            border-bottom-color: var(--medium-gray);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* About Tab */
        .about-tab {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
        }
        
        @media (max-width: 992px) {
            .about-tab {
                grid-template-columns: 1fr;
            }
        }
        
        .about-content h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .about-content p {
            margin-bottom: 20px;
            line-height: 1.7;
            color: var(--text-light);
        }
        
        .highlights {
            margin-top: 30px;
        }
        
        .highlights h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .highlights-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .highlight-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background-color: var(--lightest-color);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }
        
        .highlight-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }
        
        .highlight-item i {
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .highlight-item span {
            font-weight: 500;
            color: var(--text-color);
        }
        
        .visitor-info {
            margin-top: 40px;
        }
        
        .visitor-info h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .info-item {
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }
        
        .info-item h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-item h4 i {
            color: var(--primary-color);
        }
        
        .info-item p {
            margin: 0;
            color: var(--text-light);
        }
        
        .map-container {
            height: 100%;
            min-height: 400px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Nearby Tab */
        .nearby-attractions h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .attractions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .attraction-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }
        
        .attraction-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--hover-shadow);
        }
        
        .attraction-img {
            height: 200px;
            position: relative;
        }
        
        .attraction-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .attraction-card:hover .attraction-img img {
            transform: scale(1.1);
        }
        
        .attraction-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .attraction-content {
            padding: 20px;
        }
        
        .attraction-content h4 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--secondary-color);
            transition: var(--transition);
        }
        
        .attraction-card:hover .attraction-content h4 {
            color: var(--primary-color);
        }
        
        .attraction-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: var(--text-light);
            font-size: 14px;
        }
        
        .attraction-location, .attraction-rating {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .attraction-location i, .attraction-rating i {
            color: var(--primary-color);
        }
        
        .attraction-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }
        
        .attraction-distance {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .attraction-link {
            color: var(--primary-color);
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .attraction-link:hover {
            color: var(--primary-dark);
        }
        
        .attraction-link i {
            transition: transform 0.3s ease;
        }
        
        .attraction-link:hover i {
            transform: translateX(3px);
        }
        
        /* Reviews Tab */
        .reviews-section h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .reviews-summary {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .overall-rating {
            text-align: center;
        }
        
        .rating-number {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
        }
        
        .rating-stars {
            color: #FFD700;
            font-size: 18px;
            margin: 5px 0;
        }
        
        .rating-count {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .rating-breakdown {
            flex: 1;
            max-width: 300px;
        }
        
        .rating-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .rating-label {
            display: flex;
            align-items: center;
            gap: 5px;
            width: 40px;
            font-size: 14px;
            color: var(--text-light);
        }
        
        .rating-label i {
            color: #FFD700;
            font-size: 12px;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
        }
        
        .rating-percentage {
            width: 40px;
            font-size: 14px;
            color: var(--text-light);
            text-align: right;
        }
        
        .write-review-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        
        .write-review-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }
        
        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .review-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--card-shadow);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .reviewer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 20px;
            font-weight: 600;
        }
        
        .reviewer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .reviewer-details h4 {
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .review-date {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .review-rating {
            color: #FFD700;
            font-size: 16px;
        }
        
        .review-content {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .review-photos {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .review-photo {
            width: 80px;
            height: 80px;
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        
        .review-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Best Time Tab */
        .best-time-tab h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .season-info {
            margin-bottom: 40px;
        }
        
        .season-info p {
            margin-bottom: 20px;
            line-height: 1.7;
            color: var(--text-light);
        }
        
        .month-map {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .month-map {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 576px) {
            .month-map {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .month {
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
        }
        
        .month:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
        }
        
        .month.low {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
        }
        
        .month.medium {
            background-color: #fff9c4;
            border: 1px solid #fff59d;
        }
        
        .month.high {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
        }
        
        .month span {
            display: block;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .month .crowd-level {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .month.low .crowd-level {
            color: #2e7d32;
        }
        
        .month.medium .crowd-level {
            color: #f9a825;
        }
        
        .month.high .crowd-level {
            color: #c62828;
        }
        
        .weather-info {
            margin-top: 40px;
        }
        
        .weather-info h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        
        .weather-info p {
            margin-bottom: 20px;
            line-height: 1.7;
            color: var(--text-light);
        }
        
        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .weather-card {
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            text-align: center;
        }
        
        .weather-card h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .weather-icon {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .weather-temp {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        
        .weather-desc {
            font-size: 14px;
            color: var(--text-light);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    {% include 'includes/notifications.html' %}

    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="place-info">
                <div class="breadcrumb">
                    <a href="/">Home</a> <i class="fas fa-chevron-right"></i>
                    <a href="/explore">Explore</a> <i class="fas fa-chevron-right"></i>
                    <span>{{ single_place.Name }}</span>
                </div>
                <h1>{{ single_place.Name }}</h1>
                <div class="location-meta">
                    <span class="location">
                        <i class="fas fa-map-marker-alt"></i> {{ single_place.City }}, {{ single_place.State }}
                    </span>
                    <span class="rating">
                        <i class="fas fa-star"></i> {{ single_place.Google_rating|default:"N/A" }} (Google rating)
                    </span>
                </div>
                <p class="description">
                    {{ single_place.Description }}
                </p>
                <div class="action-buttons">
                    <button class="estimate-button" id="estimateCostBtn">
                        <i class="fas fa-calculator"></i> Estimate Cost
                    </button>
                </div>
                <div id="cost-display" class="cost-display">
                    <div class="cost-loader">
                        <div class="loader"></div>
                        <span>Calculating...</span>
                    </div>
                    <div class="cost-results">
                        <!-- Cost results will be populated here -->
                    </div>
                </div>
            </div>
            <div class="place-image">
                <img src="{{ single_place.Image_url }}" alt="{{ single_place.Name }}">
                <div class="image-overlay">
                    <button class="gallery-button">
                        <i class="fas fa-images"></i> View Gallery
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs Section -->
        <div class="tabs-section">
            <div class="tabs-nav">
                <button class="tab-button active" data-tab="nearby">Nearby Attractions</button>
                <button class="tab-button" data-tab="reviews">Reviews</button>
                <button class="tab-button" data-tab="best-time">Best Time to Visit</button>
            </div>

            <!-- Nearby Attractions Tab -->
            <div class="tab-content active" id="nearby-tab">
                <div class="nearby-attractions">
                    <h3>Nearby Attractions</h3>
                    <div class="attractions-grid">
                        {% for place in rec_places %}
                        <div class="attraction-card">
                            <div class="attraction-img">
                                <img src="{{ place.Image_url }}" alt="{{ place.Name }}">
                                <div class="attraction-badge">Popular</div>
                            </div>
                            <div class="attraction-content">
                                <h4>{{ place.Name }}</h4>
                                <div class="attraction-meta">
                                    <div class="attraction-location">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>{{ place.City }}, {{ place.State }}</span>
                                    </div>
                                    <div class="attraction-rating">
                                        <i class="fas fa-star"></i>
                                        <span>4.7 ({{ forloop.counter|add:100 }})</span>
                                    </div>
                                </div>
                                <p>{{ place.Description|truncatechars:100 }}</p>
                                <div class="attraction-footer">
                                    <div class="attraction-distance">
                                        <i class="fas fa-route"></i> {{ forloop.counter|add:5 }} km away
                                    </div>
                                    <a href="/details/{{ place.id }}" class="attraction-link">
                                        Explore <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Reviews Tab -->
            <div class="tab-content" id="reviews-tab">
                <div class="reviews-section">
                    <div class="reviews-header">
                        <div class="reviews-summary">
                            {% if reviews %}
                                {% with avg_rating=reviews|avg_rating review_count=reviews|length %}
                                <div class="overall-rating">
                                    <div class="rating-number">{{ avg_rating|floatformat:1 }}</div>
                                    <div class="rating-stars">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= avg_rating|floatformat:0 %}
                                                <i class="fas fa-star"></i>
                                            {% elif forloop.counter <= avg_rating|add:0.5|floatformat:0 %}
                                                <i class="fas fa-star-half-alt"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <div class="rating-count">{{ review_count }} review{{ review_count|pluralize }}</div>
                                </div>
                                {% endwith %}
                                
                                <div class="rating-breakdown">
                                    {% for i in "54321" %}
                                        {% with rating_count=reviews|filter_by_rating:forloop.counter|length percentage=reviews|rating_percentage:forloop.counter %}
                                        <div class="rating-bar">
                                            <div class="rating-label">
                                                <i class="fas fa-star"></i> {{ forloop.counter }}
                                            </div>
                                            <div class="progress-bar">
                                                <div class="progress" style="width: {{ percentage }}%"></div>
                                            </div>
                                            <div class="rating-percentage">{{ percentage }}%</div>
                                        </div>
                                        {% endwith %}
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="overall-rating">
                                    <div class="rating-number">-</div>
                                    <div class="rating-stars">
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                    <div class="rating-count">No reviews yet</div>
                                </div>
                            {% endif %}
                        </div>
                        {% if user.is_authenticated %}
                        <a href="{% url 'submit_trip_review' pk=single_place.id %}" class="write-review-btn">
                            <i class="fas fa-edit"></i> Write a Review
                        </a>
                        {% else %}
                        <a href="{% url 'login' %}?next={% url 'submit_trip_review' pk=single_place.id %}" class="write-review-btn">
                            <i class="fas fa-edit"></i> Login to Write a Review
                        </a>
                        {% endif %}
                    </div>
                    <div class="reviews-list">
                        {% if reviews %}
                            {% for review in reviews %}
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <div class="reviewer-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="reviewer-details">
                                            <h4>{{ review.user.username }}</h4>
                                            <div class="review-date">{{ review.created_at|date:"F j, Y" }}</div>
                                        </div>
                                    </div>
                                    <div class="review-rating">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= review.rating %}
                                                <i class="fas fa-star"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="review-content">
                                    <h5>{{ review.title }}</h5>
                                    <p>{{ review.description }}</p>
                                    
                                    <div class="review-details">
                                        <div class="review-detail">
                                            <i class="fas fa-users"></i> Group Size: {{ review.no_of_people }}
                                        </div>
                                        <div class="review-detail">
                                            <i class="fas fa-plane-departure"></i> Travel: {{ review.get_travel_medium_display }}
                                        </div>
                                        <div class="review-detail">
                                            <i class="fas fa-ticket-alt"></i> Travel Cost: ₹{{ review.travel_cost }}
                                        </div>
                                        <div class="review-detail">
                                            <i class="fas fa-hotel"></i> Accommodation: ₹{{ review.accommodation_cost }}
                                        </div>
                                        <div class="review-detail">
                                            <i class="fas fa-utensils"></i> Food: ₹{{ review.food_cost }}
                                        </div>
                                    </div>
                                    

                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="no-reviews">
                                <i class="fas fa-comment-slash"></i>
                                <p>No reviews yet. Be the first to share your experience!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Best Time to Visit Tab -->
            <div class="tab-content" id="best-time-tab">
                <div class="best-time-section">
                    <h3>Best Time to Visit</h3>
                    <div class="season-info">
                        <p>The best time to visit {{ single_place.Name }} is during the winter months from October to March when the weather is pleasant and comfortable for sightseeing. The summer months from April to June can be extremely hot, while the monsoon season from July to September brings heavy rainfall.</p>
                    </div>
                    
                    <h3>Visitor Traffic by Month</h3>
                    <div class="month-map">
                        {% for i in crowd_data %}
                        {% if i.crowd_count == 1 %}
                        <div class="month low">
                            <span>{{ i.month }}</span>
                            <div class="crowd-level">Low Season</div>
                        </div>
                        {% elif i.crowd_count == 2 %}
                        <div class="month medium">
                            <span>{{ i.month }}</span>
                            <div class="crowd-level">Moderate</div>
                        </div>
                        {% else %}
                        <div class="month high">
                            <span>{{ i.month }}</span>
                            <div class="crowd-level">Peak Season</div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    
                    <div class="weather-info">
                        <h3>Weather Information</h3>
                        <p>{{ single_place.Name }} experiences a subtropical climate with distinct seasons. Here's what to expect throughout the year:</p>
                        
                        <div class="weather-grid">
                            <div class="weather-card">
                                <h4>Winter (Oct-Mar)</h4>
                                <div class="weather-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="weather-temp">15°C - 25°C</div>
                                <div class="weather-desc">Pleasant & Comfortable</div>
                            </div>
                            
                            <div class="weather-card">
                                <h4>Summer (Apr-Jun)</h4>
                                <div class="weather-icon">
                                    <i class="fas fa-temperature-high"></i>
                                </div>
                                <div class="weather-temp">30°C - 45°C</div>
                                <div class="weather-desc">Hot & Dry</div>
                            </div>
                            
                            <div class="weather-card">
                                <h4>Monsoon (Jul-Sep)</h4>
                                <div class="weather-icon">
                                    <i class="fas fa-cloud-rain"></i>
                                </div>
                                <div class="weather-temp">25°C - 35°C</div>
                                <div class="weather-desc">Humid & Rainy</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'includes/footer.html' %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Show corresponding content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Add CSS for the review elements
            const style = document.createElement('style');
            style.textContent = `
                .write-review-btn {
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    padding: 12px 20px;
                    background-color: var(--primary-color);
                    color: white;
                    border: none;
                    border-radius: var(--border-radius);
                    font-weight: 500;
                    font-size: 15px;
                    cursor: pointer;
                    transition: var(--transition);
                    text-decoration: none;
                }
                
                .write-review-btn:hover {
                    background-color: var(--primary-dark);
                    transform: translateY(-2px);
                    box-shadow: var(--hover-shadow);
                }
                
                .review-content h5 {
                    font-size: 18px;
                    margin-bottom: 10px;
                    color: var(--secondary-color);
                }
                
                .review-details {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                    gap: 10px;
                    margin-top: 15px;
                    background-color: var(--lightest-color);
                    padding: 15px;
                    border-radius: var(--border-radius);
                }
                
                .review-detail {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    font-size: 14px;
                    color: var(--text-light);
                }
                
                .review-detail i {
                    color: var(--primary-color);
                }
                
                .review-image {
                    margin-top: 15px;
                    border-radius: var(--border-radius);
                    overflow: hidden;
                    max-height: 300px;
                }
                
                .review-image img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }
                
                .no-reviews {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 40px;
                    background-color: var(--lightest-color);
                    border-radius: var(--border-radius);
                    text-align: center;
                }
                
                .no-reviews i {
                    font-size: 48px;
                    color: var(--text-muted);
                    margin-bottom: 15px;
                }
                
                .no-reviews p {
                    color: var(--text-light);
                    font-size: 16px;
                }
            `;
            document.head.appendChild(style);
            
            // Estimate Cost Button
            const estimateCostBtn = document.getElementById('estimateCostBtn');
            const costDisplay = document.getElementById('cost-display');
            const costLoader = document.querySelector('.cost-loader');
            const costResults = document.querySelector('.cost-results');
            
            if (estimateCostBtn) {
                estimateCostBtn.addEventListener('click', function() {
                    // Show cost display and loader
                    costDisplay.classList.add('show');
                    costLoader.style.display = 'flex';
                    costResults.innerHTML = '';
                    
                    // Get place ID from the page
                    const placeId = {{ single_place.id }};
                    
                    // Fetch cost data from the server
                    fetch(`/api/estimate-costs/${placeId}/`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Hide loader
                            costLoader.style.display = 'none';
                            
                            // Always show cost data (we now provide defaults even if no reviews)
                            // Populate results with data
                            costResults.innerHTML = `
                                <div class="cost-item">
                                    <h4><i class="fas fa-hotel"></i> Accommodation</h4>
                                    <p>₹${data.accommodation_cost.toFixed(0)} <span>per night</span></p>
                                </div>
                                <div class="cost-item">
                                    <h4><i class="fas fa-utensils"></i> Food</h4>
                                    <p>₹${data.food_cost.toFixed(0)} <span>per day</span></p>
                                </div>
                                <div class="cost-item">
                                    <h4><i class="fas fa-plane-departure"></i> Travel</h4>
                                    <p>₹${data.travel_cost.toFixed(0)} <span>average</span></p>
                                </div>
                                <div class="cost-item total-cost">
                                    <h4><i class="fas fa-coins"></i> Total Estimate</h4>
                                    <p>₹${(parseFloat(data.accommodation_cost) + parseFloat(data.food_cost) + parseFloat(data.travel_cost)).toFixed(0)} <span>per person</span></p>
                                </div>
                            `;
                            
                            // Add note about the source of data
                            const noteElement = document.createElement('div');
                            noteElement.className = 'cost-note';
                            
                            if (data.review_count > 0) {
                                noteElement.innerHTML = `
                                    <p><i class="fas fa-info-circle"></i> Based on ${data.review_count} user reviews. Actual costs may vary.</p>
                                `;
                            } else {
                                noteElement.innerHTML = `
                                    <p><i class="fas fa-info-circle"></i> These are estimated costs. Help others by <a href="{% url 'submit_trip_review' pk=single_place.id %}">submitting a review</a> with your actual expenses.</p>
                                `;
                            }
                            
                            costResults.appendChild(noteElement);
                        })
                        .catch(error => {
                            // Hide loader and show default cost estimates instead of error
                            costLoader.style.display = 'none';
                            
                            // Show default estimates even on error
                            costResults.innerHTML = `
                                <div class="cost-item">
                                    <h4><i class="fas fa-hotel"></i> Accommodation</h4>
                                    <p>₹1,500 <span>per night</span></p>
                                </div>
                                <div class="cost-item">
                                    <h4><i class="fas fa-utensils"></i> Food</h4>
                                    <p>₹800 <span>per day</span></p>
                                </div>
                                <div class="cost-item">
                                    <h4><i class="fas fa-plane-departure"></i> Travel</h4>
                                    <p>₹1,200 <span>average</span></p>
                                </div>
                                <div class="cost-item total-cost">
                                    <h4><i class="fas fa-coins"></i> Total Estimate</h4>
                                    <p>₹3,500 <span>per person</span></p>
                                </div>
                                
                                <div class="cost-note">
                                    <p><i class="fas fa-info-circle"></i> These are estimated costs. Help others by <a href="{% url 'submit_trip_review' pk=single_place.id %}">submitting a review</a> with your actual expenses.</p>
                                </div>
                            `;
                            
                            console.error('Error fetching cost data:', error);
                        });
                });
            }
        });
    </script>
</body>
</html>